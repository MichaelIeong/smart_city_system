<script type="text/html" data-template-name="Social Service">

    <div class="form-row">
        <label for="node-input-location"><i class="fa fa-map-marker"></i> Location</label>
        <select id="node-input-location">
            <option value="" disabled selected>Select Location</option>
            <option value="D2地下车库">D2地下车库</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-socialResource"><i class="fa fa-share-alt"></i> Social Resource</label>
        <select id="node-input-socialResource">
            <option value="" disabled selected>Select Social Resource</option>
            <option value="车库工作人员">车库工作人员</option>
        </select>
    </div>

</script>

<script type="text/javascript">
    RED.nodes.registerType('Social Service', {
        category: 'Service Composition',
        color: "#f4a261",
        defaults: {
            name: { value: "" },
            location: { value: "" },
            socialResource: { value: "" }
        },
        inputs: 1,
        outputs: 1,
        icon: "white-globe.svg",
        label: function () {
            if (this.socialResource) {
                return "Social Service : " + this.socialResource;
            }else {
                return "Social Service : ";
            }
        },
        oneditprepare: function () {
            var node = this;

            // 预填充Location下拉框
            $.getJSON("/api/locations", function (data) {
                var locationSelect = $("#node-input-location");
                data.forEach(function (loc) {
                    locationSelect.append($("<option></option>").attr("value", loc.id).text(loc.name));
                });
                locationSelect.val(node.location);
            });

            // 预填充SocialResource下拉框
            $.getJSON("/api/socialResources", function (data) {
                var resourceSelect = $("#node-input-socialResource");
                data.forEach(function (resource) {
                    resourceSelect.append($("<option></option>").attr("value", resource.id).text(resource.name));
                });
                resourceSelect.val(node.socialResource);
            });
        },
        oneditsave: function () {
            this.name = $("#node-input-name").val();
            this.location = $("#node-input-location").val();
            this.socialResource = $("#node-input-socialResource").val();
        }
    });
</script>