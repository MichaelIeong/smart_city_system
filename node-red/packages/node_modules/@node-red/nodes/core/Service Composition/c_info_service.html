<script type="text/html" data-template-name="Information Service">

    <div class="form-row">
        <label for="node-input-location"><i class="fa fa-map-marker"></i> Location</label>
        <select id="node-input-location">
            <option value="" disabled selected>Select location</option>
            <option value="D2地下车库">D2地下车库</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-informationResource"><i class="fa fa-info-circle"></i> Information Resource</label>
        <select id="node-input-informationResource">
            <option value="" disabled selected>Select Information Resource</option>
            <option value="车位信息">车位信息</option>
        </select>
    </div>

</script>

<script type="text/javascript">
    RED.nodes.registerType('Information Service', {
        category: 'Service Composition',
        color: "#d4a5a5",
        defaults: {
            name: { value: "" },
            location: { value: "" },
            informationResource: { value: "" }
        },
        inputs: 0,
        outputs: 1,
        icon: "envelope.svg",
        label: function () {
            if (this.informationResource) {
                return "Information Service : " + this.informationResource;
            }else {
                return "Information Service : ";
            }
        },
        oneditprepare: function () {
            var node = this;

            // 预填充Location下拉框
            $.getJSON("/api/locations", function (data) {
                var locationSelect = $("#node-input-location");
                data.forEach(function (loc) {
                    locationSelect.append($("<option></option>").attr("value", loc.id).text(loc.name));
                });
                locationSelect.val(node.location);
            });

            // 预填充InformationResource下拉框
            $.getJSON("/api/informationResources", function (data) {
                var resourceSelect = $("#node-input-informationResource");
                data.forEach(function (resource) {
                    resourceSelect.append($("<option></option>").attr("value", resource.id).text(resource.name));
                });
                resourceSelect.val(node.informationResource);
            });
        },
        oneditsave: function () {
            this.name = $("#node-input-name").val();
            this.location = $("#node-input-location").val();
            this.informationResource = $("#node-input-informationResource").val();
        }
    });
</script>