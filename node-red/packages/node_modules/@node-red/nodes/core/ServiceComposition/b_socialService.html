<script type="text/html" data-template-name="socialService">

    <div class="form-row">
        <label for="node-input-location"><i class="fa fa-map-marker"></i> 位置</label>
        <select id="node-input-location">
            <option value="" disabled selected>选择位置</option>
            <!-- 后端获取的location数据将动态添加 -->
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-socialResource"><i class="fa fa-share-alt"></i> 社会资源</label>
        <select id="node-input-socialResource">
            <option value="" disabled selected>选择社会资源</option>
            <!-- 后端获取的socialResource数据将动态添加 -->
        </select>
    </div>

</script>

<script type="text/javascript">
    RED.nodes.registerType('socialService', {
        category: 'ServiceComposition',
        color: "#f4a261",
        defaults: {
            name: { value: "" },
            location: { value: "" },
            socialResource: { value: "" }
        },
        inputs: 0,
        outputs: 1,
        icon: "node.svg",
        label: function () {
            return this.name || "socialService";
        },
        oneditprepare: function () {
            var node = this;

            // 预填充Location下拉框
            $.getJSON("/api/locations", function (data) {
                var locationSelect = $("#node-input-location");
                data.forEach(function (loc) {
                    locationSelect.append($("<option></option>").attr("value", loc.id).text(loc.name));
                });
                locationSelect.val(node.location);
            });

            // 预填充SocialResource下拉框
            $.getJSON("/api/socialResources", function (data) {
                var resourceSelect = $("#node-input-socialResource");
                data.forEach(function (resource) {
                    resourceSelect.append($("<option></option>").attr("value", resource.id).text(resource.name));
                });
                resourceSelect.val(node.socialResource);
            });
        },
        oneditsave: function () {
            this.name = $("#node-input-name").val();
            this.location = $("#node-input-location").val();
            this.socialResource = $("#node-input-socialResource").val();
        }
    });
</script>