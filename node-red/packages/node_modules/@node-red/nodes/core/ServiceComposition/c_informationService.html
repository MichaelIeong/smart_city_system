<script type="text/html" data-template-name="infoService">

    <div class="form-row">
        <label for="node-input-location"><i class="fa fa-map-marker"></i> 位置</label>
        <select id="node-input-location">
            <option value="" disabled selected>选择位置</option>
            <!-- 后端获取的location数据将动态添加 -->
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-informationResource"><i class="fa fa-info-circle"></i> 信息资源</label>
        <select id="node-input-informationResource">
            <option value="" disabled selected>选择信息资源</option>
            <!-- 后端获取的informationResource数据将动态添加 -->
        </select>
    </div>

</script>

<script type="text/javascript">
    RED.nodes.registerType('infoService', {
        category: 'ServiceComposition',
        color: "#d4a5a5",
        defaults: {
            name: { value: "" },
            location: { value: "" },
            informationResource: { value: "" }
        },
        inputs: 0,
        outputs: 1,
        icon: "node.svg",
        label: function () {
            return this.name || "infoService";
        },
        oneditprepare: function () {
            var node = this;

            // 预填充Location下拉框
            $.getJSON("/api/locations", function (data) {
                var locationSelect = $("#node-input-location");
                data.forEach(function (loc) {
                    locationSelect.append($("<option></option>").attr("value", loc.id).text(loc.name));
                });
                locationSelect.val(node.location);
            });

            // 预填充InformationResource下拉框
            $.getJSON("/api/informationResources", function (data) {
                var resourceSelect = $("#node-input-informationResource");
                data.forEach(function (resource) {
                    resourceSelect.append($("<option></option>").attr("value", resource.id).text(resource.name));
                });
                resourceSelect.val(node.informationResource);
            });
        },
        oneditsave: function () {
            this.name = $("#node-input-name").val();
            this.location = $("#node-input-location").val();
            this.informationResource = $("#node-input-informationResource").val();
        }
    });
</script>